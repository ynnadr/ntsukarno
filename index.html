<!DOCTYPE html>
<html>
<head>
  <title>Napak Tilas Sukarno</title>
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Poppins', sans-serif;
      overflow: hidden;
    }

    .header {
      display: flex;
      align-items: center;
      padding: 8px 15px;
      background-color: #ffffff;
      border-bottom: 1px solid #e0e0e0;
      height: 70px;
      box-sizing: border-box;
    }
    .header img {
      height: 45px;
      margin-right: 15px;
    }
    .header-text h3 {
      margin: 0;
      font-size: 0.9em;
      font-weight: 700;
      line-height: 1.3;
    }
    .header-text p {
      margin: 0;
      font-size: 0.75em;
    }
    
    /* === PERUBAHAN CSS UNTUK GPS === */
    .map-container {
        position: relative;
        height: calc(100vh - 70px);
        width: 100%;
    }
    #map {
      height: 100%;
      width: 100%;
    }
    .gps-controls {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 10;
        background-color: white;
        padding: 5px;
        border-radius: 40px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    .gps-controls button {
        font-family: 'Poppins', sans-serif;
        font-size: 14px;
        font-weight: 500;
        padding: 10px 20px;
        border: none;
        border-radius: 30px;
        cursor: pointer;
        transition: background-color 0.3s;
    }
    #startTrackingBtn {
        background-color: #4285F4;
        color: white;
    }
    #stopTrackingBtn {
        background-color: #EA4335;
        color: white;
        display: none; /* Sembunyikan tombol stop pada awalnya */
    }
    /* === AKHIR PERUBAHAN CSS === */
    
    .gm-style-iw-d { overflow: auto !important; }
    .gm-style-iw-c {
      padding: 12px !important;
      max-width: 300px !important;
      min-width: 240px !important;
      font-family: 'Poppins', sans-serif !important;
    }
    .info-window-content h4 { margin: 0 0 8px 0; font-size: 16px; font-weight: 700; }
    .info-window-content p { margin: 0 0 5px 0; font-size: 14px; line-height: 1.5; white-space: normal; }

    @media (min-width: 768px) {
      .header { padding: 10px 20px; height: 80px; }
      .header img { height: 60px; }
      .header-text h3 { font-size: 1.2em; }
      .header-text p { font-size: 0.9em; }
      .map-container { height: calc(100vh - 80px); }
    }
  </style>
</head>
<body>
  
  <div class="header">
    <img src="images/kpa.jpg" alt="Logo KPA">
    <div class="header-text">
      <h3>Napak Tilas Sukarno 10 Agustus 2025 - Bandung</h3>
      <p>Memperingati 95 Tahun Indonesia Menggugat Menuju Indonesia Merdeka</p>
    </div>
  </div>
  
  <!-- PERUBAHAN HTML: Bungkus Peta dan Tombol dalam satu kontainer -->
  <div class="map-container">
    <div id="map"></div>
    <!-- Tombol untuk kontrol GPS -->
    <div class="gps-controls">
      <button id="startTrackingBtn" onclick="startTracking()">Mulai Lacak Lokasi</button>
      <button id="stopTrackingBtn" onclick="stopTracking()">Berhenti Lacak</button>
    </div>
  </div>

  <script>
    // Data GeoJSON Anda (tidak ada perubahan)
    const geojsonData = {
      "type": "FeatureCollection",
      "features": [{
        "type": "Feature",
        "properties": {"name": "Etape 1:<br>ITB ke Gd. Indonesia Menggugat"},
        "geometry": { "type": "LineString", "coordinates": [ [107.61042972268677, -6.893254676090393], [107.61073093378445, -6.893261272424297], [107.61089925763127, -6.893639462055106], [107.61090590253474, -6.893872530841776], [107.6108505328474, -6.89429909299318], [107.61073979445047, -6.894749839257699], [107.61169215426406, -6.894782821271008], [107.61135994103802, -6.896662754981506], [107.61135108188756, -6.896882631131618], [107.61145517689852, -6.897438917337581], [107.61145517689852, -6.897654395613245], [107.61215947749616, -6.898571271216198], [107.61217055143322, -6.89869660012981], [107.61224142463294, -6.898821929010168], [107.61259800541603, -6.898817531505912], [107.61258692976077, -6.899103369426086], [107.61267773604794, -6.899105568176893], [107.61267109168415, -6.8991319531850195], [107.61282612553032, -6.899142946762623], [107.61271760251907, -6.900116984485294], [107.61166579294945, -6.902390404569132], [107.61146960572802, -6.902894502781351], [107.61071807231241, -6.9048050582101865], [107.6106419338044, -6.9057898676280445], [107.61065573986963, -6.906922687364158], [107.61068661322804, -6.909907245353224], [107.61046136154539, -6.913332081035307], [107.61029933357088, -6.913316623446917], [107.61030333010439, -6.913587388495543], [107.60995046154335, -6.913884115820423], [107.60911262563059, -6.9139142024532845], [107.60885508905119, -6.913891311097103], [107.60820002178207, -6.913959179236258], [107.60807473438695, -6.913808929917195] ] }
      }, {
        "type": "Feature",
        "properties": {
            "name": "Landraat / Gd. Indonesia Menggugat",
            "description": "Gedung pengadilan bersejarah tempat pidato pembelaan (pledoi) mengenai kemerdekaan: \"Indonesia Menggugat\" dibacakan oleh Sukarno pada 18 Agustus 1930. Setelah pledoi tersebut, Sukarno divonis 4 tahun penjara di Penjara Sukamiskin."
        },
        "geometry": { "type": "Point", "coordinates": [107.60804692127653, -6.913641138693535] }
      }, {
        "type": "Feature",
        "properties": { 
            "name": "Titik Start:<br>ITB Jl. Ganesha",
            "description": "Sukarno kuliah di Technische Hoogeschool te Bandoeng (sekarang ITB) pada tahun 1921 dengan jurusan teknik sipil, dan berhasil lulus pada tahun 1926."
        },
        "geometry": { "type": "Point", "coordinates": [107.61047537895223, -6.893251287860323] }
      }, {
        "type": "Feature",
        "properties": {"name": "Etape 2:<br>Gd. Indonesia Menggugat ke Penjara Banceuy"},
        "geometry": { "type": "LineString", "coordinates": [ [107.60808746244783, -6.913882064354354], [107.6081077124262, -6.91399835598024], [107.60758361989542, -6.9142611879462095], [107.60751700522712, -6.914506358362971], [107.60743055361809, -6.915325820919463], [107.60726938689663, -6.915408176518028], [107.60713238548243, -6.915543211709135], [107.60658814669455, -6.915514860942764], [107.60654572308368, -6.916109762533694], [107.60649682835157, -6.9162342624114785], [107.60622129233207, -6.916528195563529], [107.60617286309832, -6.9166485699775535], [107.60639176336952, -6.917470258547823], [107.60668549391676, -6.918766837172527], [107.60670156141873, -6.918911907909617], [107.60679070810528, -6.918892849223283], [107.60678957657063, -6.91897028220238], [107.6067456108454, -6.91905363780144], [107.60668513637393, -6.919589649397295], [107.60695826372239, -6.9196244136641525] ] }
      }, {
        "type": "Feature",
        "properties": {
            "name": "Situs Penjara Banceuy",
            "description": "Pada 29 Desember 1929, Soekarno dan tiga rekannya dari PNI ditangkap dan dipenjara di Banceuy selama Â±8 bulan. Di penjara inilah Sukarno menyusun pledoi Indonesia Menggugat."
        },
        "geometry": { "type": "Point", "coordinates": [107.60696502177666, -6.919628101873755] }, "id": 4
      }, {
        "type": "Feature",
        "properties": {"name": "Etape 3:<br>Penjara Banceuy ke Rumah Inggit Garnasih"},
        "geometry": { "type": "LineString", "coordinates": [ [107.60698875911646, -6.919639751975339], [107.60707364038501, -6.919574914641103], [107.60703254709932, -6.920038863326411], [107.60663561282576, -6.920048601542021], [107.60658009206833, -6.920362470131266], [107.60649796653269, -6.92104522286462], [107.60668124285394, -6.921067578325392], [107.6066725126098, -6.9211466706651805], [107.60506051159228, -6.920955147790622], [107.6041408324449, -6.920852490528048], [107.60398575667955, -6.923089654298593], [107.6038207945428, -6.925576753549393], [107.6037300923893, -6.927259647989018], [107.60350691837243, -6.930448254599327], [107.60344700616196, -6.931332327137966], [107.60332770249613, -6.931327392481933], [107.60332770249613, -6.9313866083472675], [107.6025174317561, -6.931342196448725], [107.60250251879887, -6.931421150931655] ] }
      }, {
        "type": "Feature",
        "properties": {
            "name": "Situs Rumah Ibu Inggit Garnasih",
            "description": "Rumah ini ditempati Inggit Garnasih dan Soekarno sejak 1926 sampai 1934. Selanjutnya, rumah ini ditempati kembali oleh Ibu Inggit seorang diri pada 1949 sampai 1984."
        },
        "geometry": { "type": "Point", "coordinates": [107.60248263485312, -6.931475432129616] }
      }, {
        "type": "Feature",
        "properties": {"name": "Etape 4:<br>Rumah Inggit Garnasih ke GOR Arcamanik"},
        "geometry": { "type": "LineString", "coordinates": [ [107.60251213176178, -6.931430975207988], [107.60253893975039, -6.931353800238256], [107.60343432564434, -6.931476215498094], [107.60323814108136, -6.9351420016703855], [107.60328206012565, -6.935367256441523], [107.60317226251738, -6.937045764409859], [107.603304019647, -6.93720562200015], [107.60601235929778, -6.937423608035402], [107.60612215690605, -6.937336413033648], [107.60638567116365, -6.937350945535229], [107.6065833068572, -6.937459939281325], [107.60905009311273, -6.937561666755315], [107.60942340511866, -6.937539856847579], [107.61117284700327, -6.937612519319472], [107.61404219879381, -6.9377069782623835], [107.61769479921247, -6.937917699323137], [107.61940032299242, -6.938026691778461], [107.61986879278618, -6.937997626816653], [107.62031530305688, -6.937924964404971], [107.62120100375904, -6.937692444612139], [107.62244537664833, -6.937002150798932], [107.62281136867313, -6.936733299250534], [107.62464864707562, -6.934960328723989], [107.62500731925945, -6.9345388838609665], [107.62513175654976, -6.934299096098371], [107.62529279328999, -6.9337468566507425], [107.62557826707052, -6.932540648277467], [107.62570270435913, -6.932068336928111], [107.62755283586432, -6.924735652039189], [107.62782337279606, -6.923762108461872], [107.62809390972791, -6.923342476989163], [107.62841517233386, -6.923023556821079], [107.62895624619762, -6.922721421726223], [107.6294804115019, -6.922486427629536], [107.63005530248222, -6.922184292190806], [107.63037656508823, -6.921932512510338], [107.63125580874834, -6.91865936377549], [107.6312392764782, -6.918547896680252], [107.63146723250065, -6.918434748598457], [107.6315128237041, -6.918491322642751], [107.63196873574776, -6.918253711610532], [107.63209981046106, -6.918231081982], [107.63373538759515, -6.917393786719586], [107.63404312822519, -6.917173147394919], [107.63416850403632, -6.917043026719938], [107.63439646005878, -6.9171788048151654], [107.63536527315136, -6.917495620219384], [107.63662473017257, -6.917885981764044], [107.63734615803645, -6.918158653695343], [107.63840166613761, -6.918472489264971], [107.6389044741124, -6.918661454453257], [107.63915695123171, -6.918819179708478], [107.63929700424558, -6.918961071922311], [107.63941799024713, -6.918880605601174], [107.63955793015606, -6.918865613366336], [107.64081083933962, -6.918194338637306], [107.64151877305346, -6.917853544545181], [107.64189458548412, -6.9177688167548865], [107.64246141621453, -6.917825129249934], [107.6427604645686, -6.917873267516839], [107.64300747450363, -6.917859015226725], [107.64326165369516, -6.9178168063710075], [107.6435452836871, -6.917857611179713], [107.64379068971442, -6.917899055175624], [107.64397624082864, -6.91786811760538], [107.6435977150486, -6.913886501715922], [107.64355380927361, -6.9137025129225975], [107.64387930029812, -6.913656582678641], [107.64391805503755, -6.913537003305322], [107.64955501301796, -6.912855679403705], [107.65359407342953, -6.9123427795413335], [107.65411132815461, -6.912331599301112], [107.65665520273632, -6.912481374142018], [107.65701817232343, -6.912541096328326], [107.65746937113283, -6.912692970052419], [107.65882285728406, -6.913292825648355], [107.65934043974016, -6.913451180397274], [107.66121289480117, -6.913839923583851], [107.66464623034733, -6.914582131342101], [107.6660942614808, -6.914894466002451], [107.66624865972358, -6.91498044970642], [107.66701903544879, -6.915164941923138], [107.66733885624404, -6.915235507098345], [107.66752092676944, -6.915388361901549], [107.66778188117763, -6.915738719504191], [107.66800688395011, -6.915960664992937], [107.66868306941598, -6.916243381370762], [107.6692241675895, -6.916415498259539], [107.66971542449988, -6.916589971858599], [107.66995225919624, -6.916681389645646], [107.67004854460237, -6.916840277592485], [107.67004757234918, -6.916838810639064], [107.67004860472247, -6.9168875865667445], [107.670656875762, -6.916947425416154], [107.67385873128433, -6.918535705846779], [107.67420873294355, -6.918802745676928], [107.67626148420288, -6.91695927181091], [107.67786765243244, -6.911681916087062], [107.67770813476767, -6.910970321780837], [107.6774313326485, -6.9103686119331655], [107.67550918213863, -6.909859843294441], [107.67536025401938, -6.91043733879107] ] }
      }, {
        "type": "Feature",
        "properties": { "name": "Titik Finish:<br>GOR Arcamanik" },
        "geometry": { "type": "Point", "coordinates": [107.67531054868118, -6.910623145643584] }
      }, {
        "type": "Feature",
        "properties": { 
            "name": "Penjara Sukamiskin",
            "description": "Setelah divonis 4 tahun, mulai 9 Desember 1930 Soekarno ditahan di kamar TA 01 Penjara Sukamiskin. Ia mendapatkan remisi dan dibebaskan pada 31 Desember 1931."
        },
        "geometry": { "type": "Point", "coordinates": [107.67545660392301, -6.906005648813675] }
      }]
    };

    let map;
    // === PERUBAHAN JS UNTUK GPS ===
    let userMarker = null; // Menyimpan marker lokasi pengguna
    let watchId = null; // Menyimpan ID proses pelacakan
    // === AKHIR PERUBAHAN ===

    function initMap() {
      // Inisialisasi peta
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: -6.917464, lng: 107.63 },
        zoom: 13
      });
      
      let cumulativeDistance = 0.0; 

      geojsonData.features.forEach(feature => {
        if (feature.geometry.type === 'LineString' && google.maps.geometry) {
            const path = feature.geometry.coordinates.map(coord => new google.maps.LatLng(coord[1], coord[0]));
            const lengthInMeters = google.maps.geometry.spherical.computeLength(path);
            const lengthInKm = lengthInMeters / 1000;
            cumulativeDistance += lengthInKm;
            feature.properties.length_km = lengthInKm.toFixed(2);
            feature.properties.total_distance_km = cumulativeDistance.toFixed(2);
        }
      });

      map.data.addGeoJson(geojsonData);
      
      map.data.setStyle(feature => {
        let color = '#FF0000';
        if (feature.geometry && feature.geometry.type === 'LineString') {
          if (feature.getProperty('name').includes('Etape 1')) { color = '#4285F4'; }
          else if (feature.getProperty('name').includes('Etape 2')) { color = '#34A853'; }
          else if (feature.getProperty('name').includes('Etape 3')) { color = '#FBBC05'; }
          else if (feature.getProperty('name').includes('Etape 4')) { color = '#EA4335'; }
        }
        return ({
          strokeColor: color,
          strokeWeight: 5,
          strokeOpacity: 0.9
        });
      });

      const infowindow = new google.maps.InfoWindow();
      map.data.addListener('click', function(event) {
        const name = event.feature.getProperty('name');
        const length = event.feature.getProperty('length_km');
        const total_distance = event.feature.getProperty('total_distance_km');
        const description = event.feature.getProperty('description');
        
        let contentString = '<div class="info-window-content">';
        if (name) {
            contentString += '<h4>' + name + '</h4>';
            if (length) {
                contentString += '<p>Panjang Etape: <b>' + length + ' km</b></p>';
            }
            if (total_distance) {
                contentString += '<p>Total Jarak dari Start: <b>' + total_distance + ' km</b></p>';
            }
            if (description) {
                contentString += '<p>' + description + '</p>';
            }
        }
        contentString += '</div>';
        
        infowindow.setContent(contentString);
        
        if (event.feature.getGeometry().getType() === 'Point') {
            infowindow.setPosition(event.feature.getGeometry().get());
        } else {
            infowindow.setPosition(event.latLng);
        }
        infowindow.setOptions({pixelOffset: new google.maps.Size(0,-35)});
        infowindow.open(map);
      });
    }

    // === FUNGSI BARU UNTUK GPS TRACKING ===

    function startTracking() {
      // Cek apakah browser mendukung Geolocation
      if (navigator.geolocation) {
        // Opsi untuk pelacakan: high accuracy & timeout
        const options = {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 0
        };

        // Mulai melacak posisi
        watchId = navigator.geolocation.watchPosition(showPosition, handleError, options);
        
        // Ganti tampilan tombol
        document.getElementById('startTrackingBtn').style.display = 'none';
        document.getElementById('stopTrackingBtn').style.display = 'block';

      } else {
        alert("Geolocation tidak didukung oleh browser ini.");
      }
    }

    function stopTracking() {
      if (watchId !== null) {
        navigator.geolocation.clearWatch(watchId);
        watchId = null;

        // Hapus marker dari peta
        if (userMarker) {
          userMarker.setMap(null);
          userMarker = null;
        }

        // Ganti tampilan tombol kembali
        document.getElementById('startTrackingBtn').style.display = 'block';
        document.getElementById('stopTrackingBtn').style.display = 'none';
      }
    }

    function showPosition(position) {
      const pos = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };
      
      // Jika marker belum ada, buat baru
      if (!userMarker) {
        userMarker = new google.maps.Marker({
          position: pos,
          map: map,
          title: "Lokasi Anda",
          // Ikon titik biru yang lebih modern
          icon: {
            path: google.maps.SymbolPath.CIRCLE,
            scale: 8,
            fillColor: "#4285F4",
            fillOpacity: 1,
            strokeColor: "white",
            strokeWeight: 2,
          }
        });
      } else {
        // Jika sudah ada, cukup pindahkan posisinya
        userMarker.setPosition(pos);
      }

      // Secara opsional, geser peta agar posisi pengguna selalu di tengah
      map.panTo(pos);
    }

    function handleError(error) {
      stopTracking(); // Hentikan pelacakan jika ada error
      switch(error.code) {
        case error.PERMISSION_DENIED:
          alert("Anda menolak permintaan untuk Geolocation.");
          break;
        case error.POSITION_UNAVAILABLE:
          alert("Informasi lokasi tidak tersedia.");
          break;
        case error.TIMEOUT:
          alert("Permintaan untuk mendapatkan lokasi pengguna timeout.");
          break;
        case error.UNKNOWN_ERROR:
          alert("Terjadi kesalahan yang tidak diketahui.");
          break;
      }
    }
  </script>

  <!-- Muat Google Maps API (jangan lupa ganti API KEY) -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA8EH9giCKPsokRtXEgsqrf38MbfOMGo50&libraries=geometry&callback=initMap" loading="async"></script>
</body>
</html>
